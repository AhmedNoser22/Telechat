@if(chatService.currentOpenedChat()){
<div class="flex flex-col h-full rounded-[2.5rem] shadow-2xl border border-pink-100 overflow-hidden relative"
     style="background: linear-gradient(160deg, #fff0f6 0%, #fce7f3 60%, #fdf2f8 100%);">

  @if(showBlockModal()){
  <div class="absolute inset-0 z-50 flex items-end justify-center pb-8 bg-black/20 backdrop-blur-sm rounded-[2.5rem]">
    <div class="w-[85%] bg-white rounded-[2rem] shadow-2xl border border-pink-100 overflow-hidden" style="animation: slideUp 0.3s cubic-bezier(.34,1.56,.64,1) both;">
      <div class="bg-gradient-to-br from-pink-400 via-rose-500 to-pink-600 p-5 flex flex-col items-center gap-1">
        <div class="bg-white/20 rounded-full p-3">
          <mat-icon class="text-white !w-7 !h-7 text-3xl">block</mat-icon>
        </div>
        <h3 class="text-white font-black text-lg tracking-tight mt-1">Block Contact?</h3>
      </div>
      <div class="p-5 flex flex-col items-center gap-1 text-center">
        <p class="text-slate-600 font-semibold text-sm">Are you sure you want to block</p>
        <p class="text-pink-500 font-black text-base">{{chatService.currentOpenedChat()?.fullName}}?</p>
        <p class="text-slate-400 text-xs mt-1 leading-relaxed">They won't be able to send you messages or see your online status.</p>
      </div>
      <div class="flex gap-3 px-5 pb-5">
        <button (click)="closeBlockModal()" class="flex-1 py-3 rounded-xl border-2 border-pink-100 text-slate-600 font-black text-sm hover:bg-pink-50 transition-all">Cancel</button>
        <button (click)="confirmBlock()" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-pink-500 to-rose-500 text-white font-black text-sm shadow-lg active:scale-95 transition-all">Block</button>
      </div>
    </div>
  </div>
  }

  <!-- Header gradient -->
  <div class="relative h-32 w-full overflow-hidden flex-shrink-0">
    <div class="absolute inset-0 bg-gradient-to-br from-pink-400 via-rose-400 to-pink-600"></div>
    <div class="absolute -top-8 -right-8 w-28 h-28 bg-white/10 rounded-full blur-2xl"></div>
    <div class="absolute -bottom-4 -left-4 w-20 h-20 bg-pink-300/20 rounded-full blur-xl"></div>
    <div class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-[#fff0f6] to-transparent"></div>
  </div>

  <!-- Avatar -->
  <div class="flex flex-col items-center -mt-14 px-5 relative z-10">
    <div class="relative p-1.5 rounded-[2rem] shadow-2xl shadow-pink-200 bg-white">
      <img class="w-24 h-24 rounded-[1.8rem] object-cover" [src]="chatService.currentOpenedChat()?.profilePicture"/>
      <div class="absolute bottom-2 right-2 h-4 w-4 rounded-full border-[3px] border-white"
           [class.bg-pink-400]="chatService.currentOpenedChat()?.isOnline"
           [class.bg-slate-300]="!chatService.currentOpenedChat()?.isOnline"></div>
    </div>

    <!-- Name -->
    <h3 class="mt-3 text-xl font-black text-slate-800 tracking-tight text-center leading-tight">
      {{chatService.currentOpenedChat()?.fullName}}
    </h3>

    <!-- Username ‚Äî ÿ®ÿØŸàŸÜ titlecase -->
    <p class="text-pink-400 font-semibold text-xs mt-0.5">@{{chatService.currentOpenedChat()?.userName}}</p>

    <!-- Nickname badge ‚Äî Ÿäÿ∏Ÿáÿ± ÿ®ÿπÿØ ÿßŸÑÿ≠ŸÅÿ∏ -->
    @if(savedNickname()){
    <div class="mt-2 flex items-center gap-1.5 px-3 py-1 rounded-full bg-gradient-to-r from-pink-100 to-rose-100 border border-pink-200" style="animation: popIn .3s cubic-bezier(.34,1.56,.64,1) both;">
      <span class="text-[10px] font-black text-pink-500 uppercase tracking-wider">‚ú¶ {{savedNickname()}}</span>
    </div>
    }

    <!-- Online status -->
    <div class="mt-2 flex items-center gap-1.5 px-3 py-1 rounded-full text-[10px] font-bold"
         [class.bg-pink-50]="chatService.currentOpenedChat()?.isOnline"
         [class.text-pink-400]="chatService.currentOpenedChat()?.isOnline"
         [class.bg-slate-100]="!chatService.currentOpenedChat()?.isOnline"
         [class.text-slate-400]="!chatService.currentOpenedChat()?.isOnline">
      <div class="w-1.5 h-1.5 rounded-full"
           [class.bg-pink-400]="chatService.currentOpenedChat()?.isOnline"
           [class.animate-pulse]="chatService.currentOpenedChat()?.isOnline"
           [class.bg-slate-300]="!chatService.currentOpenedChat()?.isOnline"></div>
      {{ chatService.currentOpenedChat()?.isOnline ? 'Online now' : 'Offline' }}
    </div>
  </div>

  <!-- Content -->
  <div class="flex-1 overflow-y-auto px-4 mt-5 space-y-3 pb-5 custom-scrollbar">

    <!-- Nickname card -->
    <div class="rounded-2xl overflow-hidden border border-pink-100 shadow-sm" style="background: rgba(255,255,255,0.75); backdrop-filter: blur(12px);">
      <div class="flex items-center gap-2 px-4 py-2.5 border-b border-pink-50">
        <span class="text-base">‚úèÔ∏è</span>
        <span class="text-[11px] font-black text-slate-500 uppercase tracking-wider">Nickname</span>
      </div>
      <div class="p-3 flex gap-2">
        @if(!editingNickname()){
        <button (click)="startEditNickname()"
                class="flex-1 text-left px-3 py-2 rounded-xl bg-pink-50 border border-pink-100 text-xs font-semibold transition-all hover:bg-pink-100"
                [class.text-pink-400]="!savedNickname()"
                [class.text-slate-700]="savedNickname()">
          {{ savedNickname() || 'Add a nickname...' }}
        </button>
        } @else {
        <input #nicknameInput type="text" [(ngModel)]="nicknameValue"
               (keydown.enter)="saveNickname()" (keydown.escape)="cancelNickname()"
               placeholder="e.g. My Bro, Love, Boss..."
               class="flex-1 text-xs bg-white border-2 border-pink-300 rounded-xl px-3 py-2 outline-none text-slate-700 placeholder-pink-200 font-semibold focus:border-pink-400 transition-colors"
               style="animation: popIn .2s cubic-bezier(.34,1.56,.64,1) both;"/>
        <button (click)="saveNickname()" class="px-3 py-2 rounded-xl text-white text-[11px] font-black active:scale-95 transition-all shadow-sm"
                style="background: linear-gradient(135deg, #f472b6, #fb7185);">Save</button>
        }
      </div>
    </div>

    <!-- Vibe card -->
    <div class="rounded-2xl overflow-hidden border border-pink-100 shadow-sm" style="background: rgba(255,255,255,0.75); backdrop-filter: blur(12px);">
      <div class="flex items-center gap-2 px-4 py-2.5 border-b border-pink-50">
        <span class="text-base">üí´</span>
        <span class="text-[11px] font-black text-slate-500 uppercase tracking-wider">Vibe</span>
      </div>
      <div class="p-3 flex justify-around">
        @for(v of vibes; track v.emoji){
        <button (click)="setVibe(v.emoji)"
                class="flex flex-col items-center gap-1 w-10 h-10 rounded-full transition-all active:scale-90 justify-center"
                [style.background]="selectedVibe() === v.emoji ? 'linear-gradient(135deg,#fce7f3,#ffe4e6)' : 'transparent'"
                [style.transform]="selectedVibe() === v.emoji ? 'scale(1.15)' : 'scale(1)'">
          <span class="text-lg leading-none">{{v.emoji}}</span>
        </button>
        }
      </div>
      @if(selectedVibe()){
      <p class="text-center text-[10px] font-bold text-pink-400 pb-2.5 tracking-wider" style="animation: popIn .2s both;">
        {{vibes | vibeLabel : selectedVibe()}}
      </p>
      }
    </div>

    <!-- Mute card -->
    <div class="rounded-2xl overflow-hidden border border-pink-100 shadow-sm" style="background: rgba(255,255,255,0.75); backdrop-filter: blur(12px);">
      <div class="p-3.5 flex items-center justify-between">
        <div class="flex items-center gap-2.5">
          <div class="w-8 h-8 rounded-xl flex items-center justify-center" style="background: linear-gradient(135deg,#fce7f3,#ffe4e6);">
            <mat-icon class="text-pink-400 !text-sm !w-4 !h-4">{{ isMuted() ? 'notifications_off' : 'notifications' }}</mat-icon>
          </div>
          <span class="text-xs font-bold text-slate-600">Mute notifications</span>
        </div>
        <button (click)="toggleMute()" class="relative w-10 h-5 rounded-full transition-all duration-300 focus:outline-none"
                [style.background]="!isMuted() ? 'linear-gradient(to right,#f472b6,#fb7185)' : '#e2e8f0'">
          <div class="absolute top-0.5 w-4 h-4 bg-white rounded-full shadow-sm transition-all duration-300"
               [class.left-5]="!isMuted()"
               [class.left-0.5]="isMuted()"></div>
        </button>
      </div>
    </div>

    <!-- Block/Unblock -->
    <div class="pt-1 pb-1">
      @if(chatService.isChatBlocked()){
      <button (click)="unblockUser()"
              class="w-full py-3.5 rounded-2xl font-black text-sm transition-all flex items-center justify-center gap-2 active:scale-95 text-white shadow-lg"
              style="background: linear-gradient(135deg, #f472b6, #ec4899);">
        <mat-icon class="!text-base">lock_open</mat-icon> UNBLOCK USER
      </button>
      } @else {
      <button (click)="openBlockModal()"
              class="w-full py-3.5 bg-white text-pink-400 hover:bg-pink-50 rounded-2xl font-black text-sm transition-all flex items-center justify-center gap-2 border border-pink-100 active:scale-95">
        <mat-icon class="!text-base">block</mat-icon> BLOCK CONTACT
      </button>
      }
    </div>

  </div>
</div>
}

<style>
  .custom-scrollbar::-webkit-scrollbar { width: 4px; }
  .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
  .custom-scrollbar::-webkit-scrollbar-thumb { background: #f9a8d4; border-radius: 10px; }
  @keyframes slideUp {
    from { transform: translateY(40px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  @keyframes popIn {
    from { transform: scale(.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }
</style>